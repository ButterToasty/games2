function startInteraction(){document.addEventListener("click",handleMouseClick),document.addEventListener("keydown",handleKeyPress)}function stopInteraction(){document.removeEventListener("keydown",handleKeyPress)}function shuffleDeck(e){for(let t=e.length-1;t>0;t--){const d=Math.floor(Math.random()*(t+1));[e[t],e[d]]=[e[d],e[t]]}return e}function handleMouseClick(e){e.target.matches("[data-key]")&&notEnd&&(pressKey(e.target.dataset.key),sounded&&playClickSound()),e.target.matches("[data-delete]")&&notEnd&&deleteKey(),e.target.matches("[data-enter]")&&notEnd&&submitGuess(),e.target.matches("[data-reload]")&&reloadKey()}function handleKeyPress(e){"Enter"===e.key&&submitGuess(),"Backspace"!==e.key&&"Delete"!==e.key||deleteKey()}function pressKey(e){const t=getActiveTiles();if(t.length>=HAND_LENGTH)return;const d=guessGrid.querySelector(":not([data-card])");d.dataset.card=e.toUpperCase(),d.textContent=e,d.dataset.state="active"}function deleteKey(){const e=getActiveTiles(),t=e[e.length-1];sounded&&playClickSound(),null!=t&&(t.textContent="",delete t.dataset.state,delete t.dataset.card)}function reloadKey(){window.location.reload()}function helpKey(){const e=document.getElementById("rulesPopup");e.classList.add("show")}function creditKey(){document.getElementById("reditPopup");reditPopup.classList.add("show")}function submitGuess(){const e=[...getActiveTiles()];if(sounded&&playClickSound(),e.length!==HAND_LENGTH)return showAlert("Not enough cards"),void shakeTiles(e);const t=e.reduce((e,t)=>e+t.dataset.card,"");stopInteraction(),document.removeEventListener("click",handleMouseClick),e.forEach((...e)=>flipTile(...e,t))}function flipTile(e,t,d,n){const a=e.dataset.card;let s=keyboard.querySelector(`[data-key="${a}"]`);setTimeout(()=>{e.classList.add("flip")},t*ANIMATION_DURATION/2),e.addEventListener("transitionend",()=>{if(e.classList.remove("flip"),hand[3*t]+hand[3*t+1]+hand[3*t+2]==a)e.dataset.state="correct",s.classList.add("correct"),result+=15+15*unopened[t],handResult+=15+15*unopened[t],flipHand(a,t);else if(hand.includes(a)&&hand[3*t]==a[0])e.dataset.state="double",s.classList.add("double"),result+=15,handResult+=15;else if(hand.includes(a))e.dataset.state="nearly",s.classList.add("nearly"),result+=8,handResult+=8;else if(hand.includes(a)||hand[3*t]!=a[0])if(!hand.includes(a)&&hand.includes(a[0]))e.dataset.state="almost",s.classList.add("almost"),result+=3,handResult+=3;else{e.dataset.state="wrong",s.classList.add("wrong");for(let e=0;e<4;e++){let t=a[0]+suits[e];"1"==a[0]&&(t=a[0]+suits[e+4]),a!=t&&(s=keyboard.querySelector(`[data-key="${t}"]`),s.classList.add("waste"))}}else e.dataset.state="placed",s.classList.add("placed"),result+=7,handResult+=7;const o=guessGrid.querySelectorAll(":not([data-card])");puzzle>5&&o.length<5&&(e.dataset.veto="ban",vetoRow6=1),showResult(),hand[3*t]+hand[3*t+1]+hand[3*t+2]==a&&(1==unopened[t]&&(dancer=!0),unopened[t]=0,correctLeft[t]=a),t===d.length-1&&e.addEventListener("transitionend",()=>{startInteraction(),checkWinLose(n,d)},{once:!0})},{once:!0})}function flipHand(e,t){let d="d",n=e[0];"1"==n&&(n="10"),e.includes("♥")&&(d="h"),e.includes("♠")&&(d="s"),e.includes("♣")&&(d="c"),0===t?card1.dataset.state=d+n:1===t?card2.dataset.state=d+n:2===t?card3.dataset.state=d+n:3===t?card4.dataset.state=d+n:card5.dataset.state=d+n}function framedCard(e,t){flipHand(e,t),0===t?card1.dataset.frame="show":1===t?card2.dataset.frame="show":2===t?card3.dataset.frame="show":3===t?card4.dataset.frame="show":card5.dataset.frame="show"}function showResult(){lives.innerHTML="♡".repeat(livesLeft),score.innerHTML=result,level.innerHTML = '<span style="color: darkred; font-size: 0.9em;">HAND:&nbsp;  </span><span style="color: green; font-size: 1.3em; font-weight: 700;">' + puzzle + '</span>';}function getActiveTiles(){return guessGrid.querySelectorAll('[data-state="active"]')}function showAlert(e,t=1e3){const d=document.createElement("div");sounded&&playClickSound(),d.textContent=e,d.classList.add("alert"),alertContainer.prepend(d),null!=t&&setTimeout(()=>{d.classList.add("hide"),d.addEventListener("transitionend",()=>{d.remove()})},t)}function shakeTiles(e){e.forEach(e=>{e.classList.add("shake"),e.addEventListener("animationend",()=>{e.classList.remove("shake")},{once:!0})})}function checkWinLose(e,t){const d=guessGrid.querySelectorAll(":not([data-card])");if(dancer&&(danceTiles(t),dancer=!1,sounded&&openSound.play()),e===hand&&!solved)return solved=!0,document.removeEventListener("click",handleMouseClick),danceTiles(t),result+=100+5*(d.length+5),handResult+=100+5*(d.length+5),card1.dataset.win="bonus",card2.dataset.win="bonus",card3.dataset.win="bonus",card4.dataset.win="bonus",card5.dataset.win="bonus",info.dataset.win="bonus",sounded&&applauseSound.play(),checkHand(),showResult(),void setTimeout(()=>{delete card1.dataset.win,delete card2.dataset.win,delete card3.dataset.win,delete card4.dataset.win,delete card5.dataset.win,delete info.dataset.win,info.innerHTML="",key.textContent="",newPuzzle()},6e3);if(d.length-5*vetoRow6<1){shakeTiles(t);for(let e=0;e<5;e++)if(1==unopened[e]){let t=hand[3*e]+hand[3*e+1]+hand[3*e+2];framedCard(t,e),key=keyboard.querySelector(`[data-key="${t}"]`),key.classList.add("framed")}if(livesLeft=livesLeft+Number(solved)-1,livesLeft<1)notEnd=!1,lives.dataset.state="game-over",sounded&&gameOverSound.play(),showResult(),info.innerHTML="FINAL RESULT: "+result,showAlert("Press NEW GAME to continue",7e3),stopInteraction();else{!solved&&sounded&&deathSound.play(),info.innerHTML="CLICK or press any key TO CONTINUE";var n=setTimeout(()=>{newPuzzle(),s()},2e4);function a(){clearTimeout(n),newPuzzle(),s()}function s(){document.removeEventListener("click",a),document.removeEventListener("keydown",a)}document.addEventListener("click",a),document.addEventListener("keydown",a)}}}function danceTiles(e){e.forEach((e,t)=>{setTimeout(()=>{e.classList.add("dance"),e.addEventListener("animationend",()=>{e.classList.remove("dance")},{once:!0})},t*ANIMATION_DURATION/5)})}function newPuzzle(){[...keyboard.querySelectorAll(".key")].map(e=>e.className="key"),[...guessGrid.querySelectorAll(".tile")].forEach(e=>{e.textContent="",delete e.dataset.card,delete e.dataset.state}),delete card5.dataset.state,delete card4.dataset.state,delete card3.dataset.state,delete card2.dataset.state,delete card1.dataset.state,delete card5.dataset.frame,delete card4.dataset.frame,delete card3.dataset.frame,delete card2.dataset.frame,delete card1.dataset.frame,solved=!1,notEnd=!0,handResult=0,puzzle+=1,puzzle%10==0&&(showAlert("EXTRA LIFE!",duration=2e3),livesLeft+=1),info.innerHTML=puzzle-puzzle*vetoRow6>5?"Once used the last 6th row will disappear!":"",unopened=[1,1,1,1,1],correctLeft=[" "," "," "," "," "],deck=shuffleDeck(deck),hand=deck[0]+deck[1]+deck[2]+deck[3]+deck[4],showResult(),startInteraction()}function toggleRulesPopup(){const e=document.getElementById("rulesPopup");e.classList.toggle("show")}function closeRulesPopup(){const e=document.getElementById("rulesPopup");e.classList.remove("show")}function toggleCreditPopup(){const e=document.getElementById("creditPopup");e.classList.toggle("show")}function closeCreditPopup(){const e=document.getElementById("creditPopup");e.classList.remove("show")}const HAND_LENGTH=5,ANIMATION_DURATION=500,keyboard=document.querySelector("[data-keyboard]"),alertContainer=document.querySelector("[data-alert-container]"),guessGrid=document.querySelector("[data-guess-grid]"),suits=["♦ ","♥ ","♣ ","♠ ","0♦","0♥","0♣","0♠"],musicTheme=document.getElementById("musicTheme"),applauseSound=document.getElementById("applauseSound"),gameOverSound=document.getElementById("gameOverSound"),openSound=document.getElementById("openSound"),deathSound=document.getElementById("deathSound");var deck=[...sortedDeck];deck=shuffleDeck(deck);var hand=deck[0]+deck[1]+deck[2]+deck[3]+deck[4],livesLeft=3,result=0,handResult=0,solved=!1,unopened=[1,1,1,1,1],dancer=!1,notEnd=!0,correctLeft=[" "," "," "," "," "],puzzle=1,vetoRow6=0;let introVideo=document.getElementById("intro-video"),playCount=0;introVideo.volume=.2,introVideo.addEventListener("ended",()=>{playCount++,playCount<2?(introVideo.currentTime=0,introVideo.play()):introVideo.style.display="none"}),preloadAssets(assets,showResult()),startInteraction();const creditButton=document.querySelector("[data-credit]");creditButton.addEventListener("click",toggleCreditPopup);const close2Button=document.querySelector(".close2-button");close2Button.addEventListener("click",closeCreditPopup);const rulesButton=document.querySelector("[data-rules]");rulesButton.addEventListener("click",toggleRulesPopup);const closeButton=document.querySelector(".close-button");closeButton.addEventListener("click",closeRulesPopup);